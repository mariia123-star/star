# –°–∏—Å—Ç–µ–º–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –¥–ª—è —Å–º–µ—Ç - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## –û–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å–º–µ—Ç–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –∏ –Ω–∞—Ü–µ–Ω–æ–∫ –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É "–ö–ª–∞–¥–∫–∞/–í–∏—Ç—Ä–∞–∂".

## –°–æ–∑–¥–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏

### 1. `src/shared/lib/estimateCoefficients.ts`

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏ —Ä–∞—Å—á–µ—Ç–∞**

- `EstimateCoefficients` - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
- `DEFAULT_COEFFICIENTS` - –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- `loadCoefficients()` - –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
- `saveCoefficients()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
- `resetCoefficients()` - —Å–±—Ä–æ—Å –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã:**

- `sm: 0.06` - –†–∞–±–æ—Ç—ã –°–ú (—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –º–æ–Ω—Ç–∞–∂)
- `mbp: 0.08` - –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ú–ë–ü
- `warranty: 0.05` - –ì–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- `work16: 0.6` - –†–∞–±–æ—Ç—ã 1.6
- `workGrowth: 0.1` - –†–∞–±–æ—Ç—ã —Ä–æ—Å—Ç
- `matGrowth: 0.1` - –ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Ä–æ—Å—Ç
- `unforeseen: 0.03` - –ù–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã–µ
- `subOOZ: 0.1` - –°—É–±–ø–æ–¥—Ä—è–¥ –û–û–ó
- `workMatOOZ: 0.1` - –†–∞–±+–ú–∞—Ç –û–û–ó
- `workMatOFZ: 0.2` - –†–∞–±+–ú–∞—Ç –û–§–ó
- `workMatProfit: 0.1` - –†–∞–±+–ú–∞—Ç –ø—Ä–∏–±—ã–ª—å
- `subProfit: 0.16` - –°—É–±–ø–æ–¥—Ä—è–¥ –ø—Ä–∏–±—ã–ª—å

### 2. `src/shared/lib/estimateCalculations.ts`

**–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**

- `calculateRow(row, coefficients)` - —Ä–∞—Å—á–µ—Ç –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ —Å–º–µ—Ç—ã
- `calculateTotals(rows, coefficients)` - —Ä–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤—ã—Ö —Å—É–º–º
- `formatCurrency(value)` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã
- `formatCurrencyWithSymbol(value)` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Å–∏–º–≤–æ–ª–æ–º ‚ÇΩ

**–†–µ–∑—É–ª—å—Ç–∞—Ç calculateRow –≤–∫–ª—é—á–∞–µ—Ç:**

- `total` - –ò—Ç–æ–≥–æ (–±–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å)
- `workPZ` - –†–∞–±–æ—Ç—ã –ü–ó
- `workSM` - –†–∞–±–æ—Ç—ã –°–ú
- `matMBP` - –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ú–ë–ü
- `matPZ` - –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ü–ó
- `subPZ` - –°—É–±–ø–æ–¥—Ä—è–¥ –ü–ó
- `warranty` - –ì–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- `work16` - –†–∞–±–æ—Ç—ã 1.6
- `workGrowth` - –†–∞–±–æ—Ç—ã —Ä–æ—Å—Ç
- `matGrowth` - –ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Ä–æ—Å—Ç
- `unforeseen` - –ù–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã–µ
- `subOOZ` - –°—É–±–ø–æ–¥—Ä—è–¥ –û–û–ó
- `workMatOOZ` - –†–∞–±+–ú–∞—Ç –û–û–ó
- `workMatOFZ` - –†–∞–±+–ú–∞—Ç –û–§–ó
- `workMatProfit` - –†–∞–±+–ú–∞—Ç –ø—Ä–∏–±—ã–ª—å
- `subProfit` - –°—É–±–ø–æ–¥—Ä—è–¥ –ø—Ä–∏–±—ã–ª—å
- `materialsInKP` - **–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –≤ –ö–ü (–∏—Ç–æ–≥)**
- `worksInKP` - **–†–∞–±–æ—Ç—ã –≤ –ö–ü (–∏—Ç–æ–≥)**

### 3. `src/widgets/estimate/CoefficientsPanel.tsx`

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏**

–ü–∞–Ω–µ–ª—å —Å –ø–æ–ª—è–º–∏ –≤–≤–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤, –∫–Ω–æ–ø–∫–∞–º–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" –∏ "–°–±—Ä–æ—Å–∏—Ç—å".

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ TenderTest.tsx

### –®–∞–≥ 1: –ò–º–ø–æ—Ä—Ç—ã

```typescript
import { useState, useEffect } from 'react'
import { CoefficientsPanel } from '@/widgets/estimate/CoefficientsPanel'
import {
  loadCoefficients,
  type EstimateCoefficients,
} from '@/shared/lib/estimateCoefficients'
import {
  calculateRow,
  calculateTotals,
  formatCurrencyWithSymbol,
  type EstimateRow,
} from '@/shared/lib/estimateCalculations'
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤

```typescript
export default function TenderTest() {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

  const [coefficients, setCoefficients] =
    useState<EstimateCoefficients>(loadCoefficients())

  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
}
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –ø–∞–Ω–µ–ª—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –≤ UI

–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ —Ç–∞–±–ª–∏—Ü–µ–π –∏–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –≤–∫–ª–∞–¥–∫—É:

```typescript
<CoefficientsPanel
  coefficients={coefficients}
  onChange={setCoefficients}
/>
```

### –®–∞–≥ 4: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∫ —Å—Ç—Ä–æ–∫–∞–º

```typescript
// –ü—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
const row: EstimateRow = {
  id: position.id,
  materialType: position.materialType || '',
  rowType: position.rowType || '—Ä–∞–±',
  workName: position.name,
  unit: position.unit,
  volume: position.volume,
  materialCoef: position.materialCoef || 1,
  workVolume: position.workVolume || position.volume,
  workPrice: position.price,
  matPriceNoDelivery: position.matPriceNoDelivery || 0,
  delivery: position.delivery || 0,
  matPriceWithDelivery: position.matPriceWithDelivery || 0,
}

const calc = calculateRow(row, coefficients)

// calc.materialsInKP - –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
// calc.worksInKP - –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç
// calc.materialsInKP + calc.worksInKP - –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏
```

### –®–∞–≥ 5: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤

```typescript
const totals = calculateTotals(rows, coefficients)

// totals.totalMaterials - –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
// totals.totalWorks - –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç
// totals.grandTotal - –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–º–µ—Ç—ã
```

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü—É

–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–ª–æ–Ω–∫–∏:

```typescript
const columns = [
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ ...
  {
    title: '–ò—Ç–æ–≥–æ',
    key: 'total',
    render: record => {
      const calc = calculateRow(convertToEstimateRow(record), coefficients)
      return formatCurrencyWithSymbol(calc.total)
    },
  },
  {
    title: '–†–∞–± –ü–ó',
    key: 'workPZ',
    render: record => {
      const calc = calculateRow(convertToEstimateRow(record), coefficients)
      return formatCurrencyWithSymbol(calc.workPZ)
    },
  },
  // ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π ...
  {
    title: '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –≤ –ö–ü',
    key: 'materialsInKP',
    render: record => {
      const calc = calculateRow(convertToEstimateRow(record), coefficients)
      return formatCurrencyWithSymbol(calc.materialsInKP)
    },
  },
  {
    title: '–†–∞–±–æ—Ç—ã –≤ –ö–ü',
    key: 'worksInKP',
    render: record => {
      const calc = calculateRow(convertToEstimateRow(record), coefficients)
      return formatCurrencyWithSymbol(calc.worksInKP)
    },
  },
]
```

## –¢–∏–ø—ã —Å—Ç—Ä–æ–∫ —Å–º–µ—Ç—ã

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã —Å—Ç—Ä–æ–∫:

1. **–ó–∞–∫–∞–∑—á–∏–∫** - –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (–Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Ä–∞—Å—á–µ—Ç–∞—Ö)
2. **—Ä–∞–±** - —Ä–∞–±–æ—Ç—ã (–ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç)
3. **–º–∞—Ç** - –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤)
4. **—Å—É–±-—Ä–∞–±** - —Å—É–±–ø–æ–¥—Ä—è–¥–Ω—ã–µ —Ä–∞–±–æ—Ç—ã
5. **—Å—É–±-–º–∞—Ç** - —Å—É–±–ø–æ–¥—Ä—è–¥–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
6. **–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å** - –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å

## –¢–∏–ø—ã –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

- **–æ—Å–Ω–æ–≤** - –æ—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (—É—á–∞—Å—Ç–≤—É—é—Ç –≤ —Ä–∞—Å—á–µ—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ü–ó)
- **–≤—Å–ø–æ–º** - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å:

- üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
- üì• –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
- üîÑ –°–±—Ä–æ—Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
- üìä –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤

## –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–°–º. –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥ –≤ –Ω–∞—á–∞–ª–µ —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ - –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å —Å–∏—Å—Ç–µ–º–æ–π –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

```typescript
const testRow: EstimateRow = {
  id: '1',
  materialType: '',
  rowType: '—Ä–∞–±',
  workName: '–î–ï–ú–û–ù–¢–ê–ñ –°–¢–ï–ù',
  unit: '–º3',
  volume: 17.2,
  materialCoef: 1,
  workVolume: 17.2,
  workPrice: 3200,
  matPriceNoDelivery: 0,
  delivery: 0,
  matPriceWithDelivery: 0,
}

const result = calculateRow(testRow, DEFAULT_COEFFICIENTS)
console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞:', result)
// –û–∂–∏–¥–∞–µ—Ç—Å—è: worksInKP –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å—Ç—Ä–æ–∫:

- –í—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞ O(1) –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏
- –ù–µ—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö (—á–∏—Å–ª–∞ –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫)
2. –ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –≤ EstimateRow
3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å >= 0)
4. –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
