# Инструкции по настройке базы данных

## ⚠️ ВАЖНО: Выполните эту миграцию перед использованием сохранения расценок!

### Шаг 1: Применить миграцию базы данных

1. Откройте **Supabase Dashboard** → **SQL Editor**
2. Скопируйте содержимое файла `supabase/rates_materials_migration.sql`
3. Вставьте в SQL Editor и выполните (кнопка "Run")

### Шаг 2: Проверить создание таблицы

Выполните в SQL Editor:

```sql
SELECT * FROM public.rate_materials_mapping LIMIT 1;
```

Должна вернуться пустая таблица (не ошибка).

### Шаг 3: Готово!

Теперь все изменения в расценках и материалах будут сохраняться в базе данных.

### Таблица rate_materials_mapping

**Назначение**: Связывает расценки с материалами и их расходом

**Поля**:

- `id` - UUID первичный ключ
- `rate_id` - ID расценки (foreign key)
- `material_id` - ID материала (foreign key)
- `consumption` - Расход материала (число с 3 знаками после запятой)
- `unit_price` - Цена за единицу на момент добавления
- `notes` - Дополнительные примечания
- `created_at` - Дата создания
- `updated_at` - Дата последнего изменения

**Ограничения**:

- Уникальная пара (rate_id, material_id)
- Каскадное удаление при удалении расценки или материала
